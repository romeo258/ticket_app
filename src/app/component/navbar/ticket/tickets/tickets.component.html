<div class="container mx-auto">
   <div class="flex flex-wrap justify-between items-center md:flex-nowrap space-y-2 md:space-y-0">
     <h3 class="text-xl font-bold">Tickets ({{store?.tickets()?.length}})</h3>
     <div class="flex flex-wrap md:flex-nowrap justify-between items-center space-x-0 md:space-x-4 space-y-2 md:space-y-0">
        <select (change)="log($event)" (change)="filterTickets({ page: 0, size: store?.query().size, status: $event.target.value === 'Status (All)' ? '': $event.target.value, type: store?.query().type, filter: store?.query().filter })" name="status" class="w-full rounded-md border-0 ml-0 px-2 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-full0 sm:text-sm sm:leading-6">
        @for (status of ['Status (All)', 'NEW', 'IN PROGRESS', 'IN REVIEW', 'COMPLETED', 'IMPEDED', 'ASSIGNED', 'UNASSIGNED', 'CLOSED', 'PENDING']; track status) {
        <option
        [selected]="store?.query()?.status === status"
        [value]="status">{{status}}</option>
        }
        </select>
        <select (change)="log($event)" (change)="filterTickets({ page: 0, size: store?.query().size, status: store?.query().status, type:  $event.target.value === 'Type (All)' ? '': $event.target.value, filter: store?.query().filter })" name="status" class="w-full rounded-md border-0 ml-0 px-2 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-full0 sm:text-sm sm:leading-6">
        @for (type of ['Type (All)', 'BUG', 'DEFECT', 'INCIDENT', 'ENHANCEMENT', 'DESIGN']; track type) {
        <option
        [selected]="store?.query()?.type === type"
        [value]="type">{{type}}</option>
        }
        </select>
        <input (input)="searchTickets({ page: 0, size: store?.query().size, status: store?.query().status, type:  store?.query().type, filter: $event.target.value })" type="search" name="title" [value]="store?.query().filter" placeholder="Search ticket title" class="w-full min-w-60 rounded-md border-0 px-2 py-1.5  text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
     </div>
  </div>
  <div class="mx-auto mt-3 mb-3 border-t border-gray-200"></div>
</div>
@if (store?.tickets()?.length > 0) {
<div class="container mx-auto">
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-y-10 gap-x-6">
     @for (ticket of store?.tickets(); track ticket.ticketId) {
     <div class="p-4 flex flex-col rounded-xl bg-white border border-solid border-gray-200 overflow-auto">
        <div class="flex flex-row justify-between items-center">
           <div class="flex flex-row justify-between items-center gap-2">
              <div class="bg-gray-300 p-1 rounded-full text-[#0a365e] cursor-pointer">
                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                       d="M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 0 1 0 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 0 1 0-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375Z" />
                 </svg>
              </div>
              <h4 [routerLink]="['/tickets/', ticket.ticketUuid]" class="cursor-pointer font-sans text-md font-medium text-gray-900">
                 Ticket #{{ticket.ticketUuid.toUpperCase().split('-')[4]}}
                 <span [ngClass]="[
                    ticket.type === 'ENHANCEMENT' ? 'bg-cyan-300' : '',
                    ticket.type === 'INCIDENT' ? 'bg-yellow-400' : '',
                    ticket.type === 'DEFECT' ? 'bg-red-400' : '',
                    ticket.type === 'DESIGN' ? 'bg-sky-500' : '',
                    ticket.type === 'BUG' ? 'bg-red-600' : '']"
                    class="text-xs font-medium w-fit px-1.5 py-0.5 rounded">
                 {{ticket.type}}</span>
              </h4>
           </div>
           <div class="cursor-pointer">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                 <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
              </svg>
           </div>
        </div>
        <h5 [routerLink]="['/tickets/', ticket.ticketUuid]" class="mt-4 cursor-pointer text-base font-semibold text-gray-900 line-clamp-1">
           {{ticket.title}}
        </h5>
        <p [routerLink]="['/tickets/', ticket.ticketUuid]" class="cursor-pointer overflow-hidden line-clamp-2 text-md">
           {{ticket.description}}
        </p>
        <div class="mt-4 flex flex-row justify-between items-center">
           <span [ngClass]="[ticket.status === 'COMPLETED' ? 'bg-green-600' : '',
              ticket.status === 'NEW' ? 'bg-yellow-400' : '',
              ticket.status === 'IN PROGRESS' ? 'bg-green-400' : '',
              ticket.status === 'IN REVIEW' ? 'bg-sky-500' : '',
              ticket.status === 'CLOSED' ? 'bg-red-700' : '',
              ticket.status === 'PENDING' ? 'bg-orange-400' : '',
              ticket.status === 'ASSIGNED' ? 'bg-blue-600' : '',
              ticket.status === 'UNASSIGNED' ? 'bg-yellow-600' : '',
              ticket.status === 'IMPEDED' ? 'bg-red-500' : '']"
              class="text-white text-xs font-semibold px-1 py-0.5 rounded">
           {{ticket.status}}
           </span>
           <div class="flex flex-row justify-between items-center gap-8">
              <div class="flex flex-row justify-between items-center gap-1">
                 <div class="cursor-pointer text-xs">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                       stroke="currentColor" class="size-5">
                       <path stroke-linecap="round" stroke-linejoin="round"
                          d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13" />
                    </svg>
                 </div>
                 <span>{{ticket.fileCount}}</span>
              </div>
              <div class="flex flex-row justify-between items-center gap-1">
                 <div class="cursor-pointer text-xs">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                       stroke="currentColor" class="size-5">
                       <path stroke-linecap="round" stroke-linejoin="round"
                          d="M8.625 9.75a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375m-13.5 3.01c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.184-4.183a1.14 1.14 0 0 1 .778-.332 48.294 48.294 0 0 0 5.83-.498c1.585-.233 2.708-1.626 2.708-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" />
                    </svg>
                 </div>
                 <span>{{ticket.commentCount}}</span>
              </div>
           </div>
        </div>
        <div class="mt-2 flex flex-row justify-between items-center flex-wrap gap-1">
           <div class="min-w-44 bg-gray-200 rounded-full h-3">
              <div [ngClass]="[ticket.progress === 0 ? 'text-blue-600' : 'text-blue-100']"
              class="bg-blue-600 text-xs font-medium text-center h-3 leading-none rounded-full" [style.width]="ticket.progress + '%'">{{ticket.progress}}%
           </div>
        </div>
        <p class="antialiased font-sans text-sm font-medium text-blue-gray-500">Since {{ticket.createdAt | date: 'mediumDate'}}</p>
     </div>
  </div>
  }
</div>
@if (store?.pages() > 0) {
<nav class="mt-6 flex justify-center" aria-label="Page navigation">
  <ul class="flex items-center -space-x-px h-10 text-base">
     <li [ngClass]="[this.store?.currentPage() == 0 ? 'pointer-events-none opacity-40' : 'cursor-pointer']">
        <a (click)="filterTickets({ page: store?.query().page - 1, size: store?.query().size, status: store?.query().status, type:  store?.query().type, filter: store?.query().filter })" class="flex items-center justify-center px-4 h-10 ms-0 leading-tight text-blue-600 bg-white border border-blue-300 border-e-0 rounded-s-lg hover:bg-gray-100 hover:text-gray-700">
           <span class="sr-only">Previous</span>
           <svg class="w-3 h-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4" />
           </svg>
        </a>
     </li>
     <!-- @for (page of [].constructor(store?.pages()); track $index) { -->
     @for (page of store?.pages() | ExtractArrayValue : 'number'; track $index) {
     <li [ngClass]="[this.store?.currentPage() == page ? 'bg-blue-50' : 'bg-white']" class="cursor-pointer">
        <a (click)="filterTickets({ page, size: store?.query().size, status: store?.query().status, type:  store?.query().type, filter: store?.query().filter })" class="flex items-center justify-center px-4 h-10 leading-tight text-blue-600 border border-blue-300 hover:bg-blue-100 hover:text-blue-700">
        {{page + 1}}
        </a>
     </li>
     }
     <li [ngClass]="[this.store?.currentPage() + 1 == store?.pages() ? 'pointer-events-none opacity-40' : 'cursor-pointer']">
        <a (click)="filterTickets({ page: store?.query().page + 1, size: store?.query().size, status: store?.query().status, type:  store?.query().type, filter: store?.query().filter })" class="flex items-center justify-center px-4 h-10 leading-tight text-blue-600 bg-white border border-blue-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700">
           <span class="sr-only">Next</span>
           <svg class="w-3 h-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
              viewBox="0 0 6 10">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                 d="m1 9 4-4-4-4" />
           </svg>
        </a>
     </li>
  </ul>
</nav>
}
</div>
}
@if(store?.tickets()?.length == 0) {
<div class="container mx-auto">
  <p class="text-lg font-semibold flex justify-center items-center">No tickets found</p>
</div>
}
@if (!store?.tickets()) {
<div class="container mx-auto">
  <div class="mt-5 grid gap-y-10 gap-x-6 md:grid-cols-3 xl:grid-cols-3">
     @for (ticketCard of [1, 2, 3, 4, 5, 6, 7]; track ticketCard) {
     <div class="p-4 animate-pulse flex flex-col rounded-xl bg-white border border-solid border-gray-200 overflow-auto">
        <div class="h-2 bg-gray-200 rounded-full w-full mb-2.5"></div>
        <div class="h-2 bg-gray-200 rounded-full w-full mb-2.5"></div>
        <div class="h-2 bg-gray-200 rounded-full w-full mb-2.5"></div>
        <div class="h-2 bg-gray-200 rounded-full w-full mb-2.5"></div>
        <div class="h-2 bg-gray-200 rounded-full w-full mb-2.5"></div>
        <div class="h-2 bg-gray-200 rounded-full w-full mb-2.5"></div>
        <div class="h-2 bg-gray-200 rounded-full w-full mb-2.5"></div>
        <div class="h-2 bg-gray-200 rounded-full w-full"></div>
     </div>
     }
  </div>
</div>
}
